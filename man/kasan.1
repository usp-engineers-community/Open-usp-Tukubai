.TH  Tukubai 1 "21 Nov 2022" "usp Tukubai" "Tukubai コマンド マニュアル"

.br
kasan(1)
.br

.br
【名前】
.br

.br
kasan\ :\ 累計
.br

.br
【書式】
.br

.br
Usage\ \ \ :\ kasan\ [+r]\ [ref=<ref>]\ key=<n>\ [<file>]
.br
Version\ :\ Mon\ Nov\ 15\ 02:12:05\ JST\ 2022
.br

.br
【説明】
.br

.br
引数のファイルまたは標準入力のテキストデータの指定したフィールドの値を、各行ご
.br
とに加算して指定したフィールドの次のフィールドに挿入する。累計値を求める場合な
.br
どに使用する。
.br
<file>として-を指定するか省略すると標準入力を使用する。
.br

.br
【例1】
.br

.br
店別の累計の仕入れ値を算出する。ここでは4フィールド目の値を加算して5フィールド
.br
目に挿入する。
.br

.br

  $ cat data
  a店 1日目 103 62                ←店名 日付 売れ数 仕入数
  a店 2日目 157 94
  a店 3日目 62 30
  a店 4日目 131 84
  a店 5日目 189 111
  a店 6日目 350 20
  a店 7日目 412 301

  $

.br

  $ kasan key=4 data
  a店 1日目 103 62 62
  a店 2日目 157 94 156
  a店 3日目 62 30 186
  a店 4日目 131 84 270
  a店 5日目 189 111 381
  a店 6日目 350 20 401
  a店 7日目 412 301 702

  $

.br
【例2】
.br

.br
あるフィールドの値が変わった場所で加算をリセットする場合は、そのリセットのキー
.br
となるフィールドをref=で指定する。たとえば店別の累計仕入数を算出する場合には、
.br
次のように1フィールド目が変更されるごとに加算をリセットする。
.br

.br
ref=<ref>で指定できるのは数値、範囲(/)、NF\ NF-<n>である。
.br

.br

  $ cat data
  a店 1日目 103 62                ←店名 日付 売れ数 仕入数
  a店 2日目 157 94
  a店 3日目 62 30
  a店 4日目 131 84
  b店 1日目 210 113
  b店 2日目 237 121
  b店 3日目 150 82
  b店 4日目 198 105
  c店 1日目 81 52
  c店 2日目 76 49
  c店 3日目 38 21
  c店 4日目 81 48

  $

.br

  $ kasan ref=1 key=4 data
  a店 1日目 103 62 62
  a店 2日目 157 94 156
  a店 3日目 62 30 186
  a店 4日目 131 84 270
  b店 1日目 210 113 113           ←累計加算をリセット
  b店 2日目 237 121 234
  b店 3日目 150 82 316
  b店 4日目 198 105 421
  c店 1日目 81 52 52              ←累計加算をリセット
  c店 2日目 76 49 101
  c店 3日目 38 21 122
  c店 4日目 81 48 17

  $

.br
【例3】
.br

.br
元データのフィールドをその加算値と置き換えて出力する場合は+rオプションを使用す
.br
る。たとえば仕入れ数を累計仕入れ数に置き換えるのであれば、この場合であれば4フィ
.br
ールド目の加算値を4フィールド目に出力するようにすれば良い。
.br

.br

  $ cat data              ←店名 日付 売れ数 仕入数
  a店 1日目 103 62
  a店 2日目 157 94
  a店 3日目 62 30
  a店 4日目 131 84
  a店 5日目 189 111
  a店 6日目 350 20
  a店 7日目 412 301

  $

.br

  $ kasan +r key=4 data
  a店 1日目 103 62
  a店 2日目 157 156
  a店 3日目 62 186
  a店 4日目 131 270
  a店 5日目 189 381
  a店 6日目 350 401
  a店 7日目 412 702

  $

.br
【例4】
.br

.br
小数点のあるデータを加算する場合、それまでの行にある最大小数桁数に合わせて出力
.br
するようになる。
.br

.br

  $ cat data
  A 1
  A 1.2
  A 1.23
  B 2
  B 2.34
  B 3

  $

.br

  $ kasan ref=1 key=2 data
  A 1 1
  A 1.2 2.2
  A 1.23 3.43
  B 2 2
  B 2.34 4.34
  B 3 7.34

  $

.br
【例5】
.br

.br
key=<pos>で指定できるのは数値、範囲(/)、列挙(@)、NF\ NF-<n>である。
.br

.br

  $ kasan key=1 data

.br
第2から第3フィールドの各フィールドを加算し、加算値をそれぞれのフィールドの直後
.br
に挿入するには次のようにコマンドを実行する。
.br

.br

  $ cat data
  A 1 2
  A 3 4
  A 5 6

  $

.br

  $ kasan key=2/3 data
  A 1 1 2 2
  A 3 4 4 6
  A 5 9 6 12

  $

.br
第2フィールドと第4フィールドの各フィールドを加算し、加算値をそれぞれのフィール
.br
ドの直後に挿入するには次のようにコマンドを実行する。
.br

.br

  $ kasan key=2@4 data

.br
次のようにNFも指定できる。
.br

.br

  $ kasan key=NF data

.br

  $ kasan key=NF-2 data

.br
【関連項目】
.br

.br
plus(1)、ratio(1)、sm2(1)、sm4(1)、sm5(1)、ysum(1)
.br

.br
last\ modified:\ Sat\ Feb\ \ 4\ 18:01:52\ JST\ 2023
.br
Contact\ us:\ uecinfo@usp-lab.com
.br
Copyright\ (c)\ 2012-2014\ Universal\ Shell\ Programming\ Laboratory\ All\ Rights
.br
