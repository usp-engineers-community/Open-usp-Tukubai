<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ratio - UEC - usp engineers' community - Tukubaiオンラインコマンドマニュアル</title>
  <link rel="stylesheet" href="COMMON/CSS/MAIN.CSS">
  <link rel="stylesheet" href="COMMON/CSS/MENU.CSS">
  <link rel="stylesheet" href="COMMON/CSS/PRINT.CSS">
  <!--[if lte IE 8]>
  <link rel="stylesheet" href="COMMON/CSS/IE67HACK.CSS">
  <![endif]-->
  <!--[if IE 7]>
  <link rel="stylesheet" href="COMMON/CSS/IE7HACK.CSS">
  <![endif]-->
  <!--[if IE 6]>
  <link rel="stylesheet" href="COMMON/CSS/IE6HACK.CSS">
  <![endif]-->
  <script src="COMMON/JS/MENU.JS"></script>
</head>
<body>
  <div id="container">
    <div id="header">
      <div id="logo">
        <img id="logoimage" src="COMMON/IMG/TUKUBAI_LOGO.JPG">
      </div>
      <div id="title">
        <p id="slogan"></p>
        <ul id="megamenu">
          <li id="tukubai_man"><a href="index.html" class="target">Tukubaiマニュアル</a>
            <ul>
              <li><a href="1bai.html">1bai(1)</a></li>
              <li><a href="block_getlast.html">block_getlast(1)</a></li>
              <li><a href="calclock.html">calclock(1)</a></li>
              <li><a href="calsed.html">calsed(1)</a></li>
              <li><a href="cap.html">cap(1)</a></li>
              <li><a href="cgi-name.html">cgi-name(1)</a></li>
              <li><a href="check_attr_name.html">check_attr_name(1)</a></li>
              <li><a href="check_cmp_name.html">check_cmp_name(1)</a></li>
              <li><a href="check_date_name.html">check_date_name(1)</a></li>
              <li><a href="check_dble_name.html">check_dble_name(1)</a></li>
              <li><a href="check_inlist_name.html">check_inlist_name(1)</a></li>
              <li><a href="check_need_name.html">check_need_name(1)</a></li>
              <li><a href="cjoin0.html">cjoin0(1)</a></li>
              <li><a href="cjoin1.html">cjoin1(1)</a></li>
              <li><a href="cjoin1x.html">cjoin1x(1)</a></li>
              <li><a href="cjoin2.html">cjoin2(1)</a></li>
              <li><a href="cjoin2x.html">cjoin2x(1)</a></li>
              <li><a href="comma.html">comma(1)</a></li>
              <li><a href="count.html">count(1)</a></li>
              <li><a href="ctail.html">ctail(1)</a></li>
              <li><a href="dayslash.html">dayslash(1)</a></li>
              <li><a href="delf.html">delf(1)</a></li>
              <li><a href="delr.html">delr(1)</a></li>
              <li><a href="divsen.html">divsen(1)</a></li>
              <li><a href="exist.html">exist(1)</a></li>
              <li><a href="extname.html">extname(1)</a></li>
              <li><a href="filehame.html">filehame(1)</a></li>
              <li><a href="formhame.html">formhame(1)</a></li>
              <li><a href="fsed.html">fsed(1)</a></li>
              <li><a href="getfirst.html">getfirst(1)</a></li>
              <li><a href="getlast.html">getlast(1)</a></li>
              <li><a href="gyo.html">gyo(1)</a></li>
              <li><a href="haba.html">haba(1)</a></li>
              <li><a href="han.html">han(1)</a></li>
              <li><a href="isdate.html">isdate(1)</a></li>
              <li><a href="itouch.html">itouch(1)</a></li>
              <li><a href="join0.html">join0(1)</a></li>
              <li><a href="join1.html">join1(1)</a></li>
              <li><a href="join1x.html">join1x(1)</a></li>
              <li><a href="join2.html">join2(1)</a></li>
              <li><a href="join2x.html">join2x(1)</a></li>
              <li><a href="juni.html">juni(1)</a></li>
              <li><a href="kasan.html">kasan(1)</a></li>
              <li><a href="keta.html">keta(1)</a></li>
              <li><a href="keycut.html">keycut(1)</a></li>
              <li><a href="loopj.html">loopj(1)</a></li>
              <li><a href="loopx.html">loopx(1)</a></li>
              <li><a href="maezero.html">maezero(1)</a></li>
              <li><a href="man2.html">man2(1)</a></li>
              <li><a href="map.html">map(1)</a></li>
              <li><a href="marume.html">marume(1)</a></li>
              <li><a href="mdate.html">mdate(1)</a></li>
              <li><a href="mime-read.html">mime-read(1)</a></li>
              <li><a href="mojihame.html">mojihame(1)</a></li>
              <li><a href="msort.html">msort(1)</a></li>
              <li><a href="nameread.html">nameread(1)</a></li>
              <li><a href="numchar.html">numchar(1)</a></li>
              <li><a href="plus.html">plus(1)</a></li>
              <li><a href="rank.html">rank(1)</a></li>
              <li><a href="ratio.html">ratio(1)</a></li>
              <li><a href="retu.html">retu(1)</a></li>
              <li><a href="rjson.html">rjson(1)</a></li>
              <li><a href="self.html">self(1)</a></li>
              <li><a href="selr.html">selr(1)</a></li>
              <li><a href="sm2.html">sm2(1)</a></li>
              <li><a href="sm4.html">sm4(1)</a></li>
              <li><a href="sm5.html">sm5(1)</a></li>
              <li><a href="tarr.html">tarr(1)</a></li>
              <li><a href="tateyoko.html">tateyoko(1)</a></li>
              <li><a href="tcat.html">tcat(1)</a></li>
              <li><a href="uconv.html">uconv(1)</a></li>
              <li><a href="ulock.html">ulock(1)</a></li>
              <li><a href="unmap.html">unmap(1)</a></li>
              <li><a href="up3.html">up3(1)</a></li>
              <li><a href="xmldir.html">xmldir(1)</a></li>
              <li><a href="yarr.html">yarr(1)</a></li>
              <li><a href="ycat.html">ycat(1)</a></li>
              <li><a href="yobi.html">yobi(1)</a></li>
              <li><a href="ysum.html">ysum(1)</a></li>
              <li><a href="zen.html">zen(1)</a></li>
              <li></li>

              <li class="separator"><hr></li>
              <li class="separator"><hr></li>
              <li class="separator"><hr></li>
              <li><a href="tag-format.html">タグ形式(5)</a></li>
              <li><a href="name-format.html">ネーム形式(5)</a></li>
              <li><a href="field-format.html">フィールド形式(5)</a></li>
              <li><a href="master-file.html">マスタファイル(5)</a></li>
              <li><a href="name-file.html">ネームファイル(5)</a></li>
              <li><a href="transaction-file.html">トランザクションファイル(5)</a></li>
            </ul> 
          </li>
        </ul>
      </div>
    </div>

    <div id="main">
      <h1>Tukubaiオンラインコマンドマニュアル</h1>

<h2>ratio(1)</h2>
<h3>【名前】</h3>
<p><code>ratio</code> :  構成比算出</p>
<h3>【書式】</h3>
<pre class="list">Usage   : ratio key=&lt;key&gt; &lt;file&gt;
Option  : ref=&lt;ref&gt;             ←参照キーの指定
        : -&lt;s&gt;                  ←小数点以下の精度
        : +&lt;n&gt;h                 ←先頭&lt;n&gt;行をヘッダーとみなす
Version : Tue Oct 20 15:17:47 JST 2020
Edition : 1

</pre>
<h3>【説明】</h3>
<p>引数のファイルまたは標準入力のテキストデータに対し、<code>key=</code>で指定したフィールドに対して全行の合計に対する各フィールドの値の構成比を算出し、次のフィールドに挿入して出力する。</p>
<h3>【例1】</h3>
<pre class="prettyprint">$ cat data
a店 1日目 103  62               ←店名 日付 売数 客数
b店 1日目 210 113
c店 1日目 81   52
d店 1日目 75   48
e店 1日目 211 140
$
</pre>
<p>売数(第3フィールド)の店別構成比を求めて売数の次のフィールドに挿入するには、次のようにコマンドを実行する。</p>
<pre class="prettyprint">$ ratio key=3 data |  keta
a店 1日目 103 15.1  62          ←第4フィールドが構成比になっている
b店 1日目 210 30.9 113
c店 1日目  81 11.9  52
d店 1日目  75 11.0  48
e店 1日目 211 31.0 140
$
</pre>
<h3>【例2】refオプション</h3>
<p><code>ref=</code>で指定したフィールドをキーフィールドとし、キーフィールドの値が同じ行の中で構成比を計算して出力する。なお、キーフィールドはあらかじめ整列されていることが条件となる。</p>
<pre class="prettyprint">$ cat data
a店 1日目 103  62               ←店名 日付 売数 客数
a店 2日目 157  94
a店 3日目  62  30
b店 1日目 210 113
b店 2日目 237 121
b店 3日目 150  82
c店 1日目  81  52
c店 2日目  76  49
c店 3日目  38  21
d店 1日目  75  48
d店 2日目  72  42
d店 3日目  34  19
e店 1日目 211 140
e店 2日目 149  91
e店 3日目 120  73
$
</pre>
<p>各日(第2フィールド)毎に店別の売数(第3フィールド)の構成比を求める。</p>
<pre class="prettyprint">$ sort -k2,2 -k1,1 data | ratio ref=2 key=3 | keta
a店 1日目 103 15.1  62          ←第4フィールドが1日目における構成比
b店 1日目 210 30.9 113
c店 1日目  81 11.9  52
d店 1日目  75 11.0  48
e店 1日目 211 31.0 140
a店 2日目 157 22.7  94          ←第4フィールドが2日目における構成比
b店 2日目 237 34.3 121
c店 2日目  76 11.0  49
d店 2日目  72 10.4  42
e店 2日目 149 21.6  91
a店 3日目  62 15.3  30          ←第4フィールドが3日目における構成比
b店 3日目 150 37.1  82
c店 3日目  38  9.4  21
d店 3日目  34  8.4  19
e店 3日目 120 29.7  73
$
</pre>
<h3>【例3】+hオプション</h3>
<p><code>+&lt;n&gt;h</code>オプションを付けると、先頭の<code>&lt;n&gt;</code>行を飛ばして構成比を計算する。先頭行に既に項目名などのヘッダーが付与されているデータを計算する場合などに使用する。新たに増える構成比のフィールドのヘッダーは@となる。</p>
<pre class="prettyprint">$ cat data
店   日付 売数 客数             ←項目名のヘッダー
a店 1日目  103   62
b店 1日目  210  113
c店 1日目   81   52
d店 1日目   75   48
e店 1日目  211  140
$
</pre>
<p>先頭行を飛ばして売数(第3フィールド)の店別構成比を求めて売数の次のフィールドに挿入する。</p>
<pre class="prettyprint">$ ratio +h key=3 data |  keta
店   日付 売数    @ 客数                ←先頭行はそのまま(計算しない)
a店 1日目  103 15.1   62                ←第4フィールドが構成比になっている
b店 1日目  210 30.9  113
c店 1日目   81 11.9   52
d店 1日目   75 11.0   48
e店 1日目  211 31.0  140
$
</pre>
<h3>【例4】-&lt;s>オプション</h3>
<p>-&lt;数値&gt;で構成比の小数点以下の精度を指定できる。</p>
<pre class="prettyprint">$ cat data
a店 1日目 103  62               ←店名 日付 売数 客数
b店 1日目 210 113
c店 1日目 81   52
d店 1日目 75   48
e店 1日目 211 140
$
</pre>
<p>売数(第3フィールド)の店別構成比を小数点3桁まで求める。</p>
<pre class="prettyprint">$ ratio -3 key=3 data |  keta
a店 1日目 103 15.147  62
b店 1日目 210 30.882 113
c店 1日目  81 11.912  52
d店 1日目  75 11.029  48
e店 1日目 211 31.029 140
$
</pre>
<h3>【関連項目】</h3>
<p><a href="kasan.html" class="command">kasan(1)</a>、<a href="plus.html" class="command">plus(1)</a>、<a href="sm2.html" class="command">sm2(1)</a>、<a href="sm4.html" class="command">sm4(1)</a>、<a href="sm5.html" class="command">sm5(1)</a>、<a href="ysum.html" class="command">ysum(1)</a></p>
    </div>

    <div id="lastmodified">Last modified: Fri Jul 15 15:42:38 JST 2022</div>

    <div id="footer">Contact us: uecinfo@usp-lab.com<br>Copyright &copy; 2012-2022 <a href="http://www.usp-lab.com/">Universal Shell Programming Laboratory</a> All Rights Reserved.</div>
  </div>
</body>
</html>
